+++
title= "并发与并行"
description= "Concurency And Parallelism"
date = "2021-12-06"
tags = [
    "golang"
]
categories = [
  "技术"
]
series = [
  "概念"
]
+++
   为了让程序更好地利用计算机资源，出现了进程/线程，以及并发模式和并行模式的概念。

### 一、进程和线程

  - A. 进程是程序在操作系统中的一次执行过程，系统进行资源分配和调度的一个独立单位。
  - B. 线程是进程的一个执行实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位。
  - C. 一个进程可以创建和撤销多个线程;同一个进程中的多个线程之间可以并发执行。

### 二、并发和并行

  - A. 多线程程序在一个核的cpu上运行，就是并发。
  - B. 多线程程序在多个核的cpu上运行，就是并行。  
  &emsp;如图所示:
  ![image](images/post/golang/Concurrency_Parallelism.webp)

### 三、并发和并行的效率比较
  &emsp;如上图所示，假定任务A/B/C均衡分配，并行效率更高，因为并发切换线程需要cpu开销(图中树立的双虚线)。  
  &emsp;但是为什么绝大多少操作系统，应用程序采用并发的机制呢？因为并行和并发是以CPU来区分，大多数场景下，需要磁盘IO、网络IO，这些IO耗时远远大于cpu耗时,所以大部分情况下并发更能充分利用计算机资源。超级计算机，比如银河超级计算机，这类计算机专注于CPU计算，所以采用并行的操作系统和程序。

### 四、协程和线程
  &emsp;随着互联网的发展，C10k问题（即单机 10000 个并发连接）出现了。CPU硬件发展不能再遵守摩尔定律,1万个线程切换的耗时变得不能承受.操作系统层面，采用epoll类似的IO多路复用技术来减少线程数.  
  &emsp;golang在语言层面采用goroutine协程减少线程开销。
  - 协程：独立的栈空间，共享堆空间，调度由用户自己控制，本质上有点类似于用户级线程，这些用户级线程的调度也是自己实现的。
  - 线程：一个线程上可以跑多个协程，协程是轻量级的线程。
  - 每个goroutine协程4~5KB的栈内存占用, 采用GMP机制管理.
